!function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return i(n?n:e)},h,h.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=[[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,0,1,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0]]},{}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=document.createElement("p"),n=document.createElement("a");n.href=e,n.target="_blank",n.innerText="gif on "+o(),t.appendChild(n),l.appendChild(t)}function o(){var e=new Date,t=s(e.getHours(),2),n=s(e.getMinutes(),2),r=s(e.getSeconds(),2);s(e.getMilliseconds(),3);return t+":"+n+":"+r}function s(e,t){return(new Array(t).join("0")+e).slice(-t)}var a=e("./modules/Tetris"),u=r(a),c=new GIFEncoder,h=new u.default,l=document.querySelector(".container");c.setRepeat(0),c.setDelay(100),h.on("gamestart",function(){c.start(),c.addFrame(h.ctx)}),h.on("tick",function(){c.addFrame(h.ctx)});h.on("gameOverEffect",function(){}),h.on("gamequit",function(){c.finish();var e=c.stream().getData(),t="data:image/gif;base64,"+encode64(e);i(t),h.newGame()}),h.newGame()},{"./modules/Tetris":3}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("jquery-deferred"),c=r(u),h=e("events"),l=r(h),f=e("./Util"),v=r(f),d=e("./TouchController"),m=r(d),p=e("../constants/SHAPE_LIST"),_=r(p),E=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=e;return e.COLS=10,e.ROWS=10,e.BLOCK_SIZE=30,e.NUMBER_OF_BLOCK=4,e.HIDDEN_ROWS=e.NUMBER_OF_BLOCK,e.LOGICAL_ROWS=e.ROWS+e.HIDDEN_ROWS,e.WIDTH=e.BLOCK_SIZE*e.COLS,e.HEIGHT=e.BLOCK_SIZE*e.ROWS,e.NEXT_WIDTH=e.BLOCK_SIZE*e.NUMBER_OF_BLOCK,e.NEXT_HEIGHT=e.BLOCK_SIZE*e.NUMBER_OF_BLOCK,e.RENDER_INTERVAL=30,e.DEFAULT_TICK_INTERVAL=250,e.SPEEDUP_RATE=10,e.START_X=Math.floor((e.COLS-e.NUMBER_OF_BLOCK)/2),e.START_Y=0,e.CLEARLINE_BLOCK_INDEX=14,e.GAMEOVER_BLOCK_INDEX=15,e.BG_COLOR="#888",e.COLOR_LIST=["#FF6666","#FFCC66","#FFFF66","#CCFF66","#66FF66","#66FFCC","#66FFFF","#66CCFF","#6666FF","#CC66FF","#FF66FF","#FF6FCF","#FF00FF","#FF8000","#4C4C4C"],e.KEYS={37:"left",39:"right",40:"down",38:"rotate",32:"rotate"},e.cnvs=document.getElementById("game-canvas"),e.ctx=e.cnvs.getContext("2d"),e.cnvsNext=document.getElementById("next-canvas"),e.ctxNext=e.cnvsNext.getContext("2d"),e.cnvs.style.width=e.WIDTH+"px",e.cnvs.style.height=e.HEIGHT+"px",e.cnvs.width=2*e.WIDTH,e.cnvs.height=2*e.HEIGHT,e.ctx.scale(2,2),e.ctx.strokeStyle=e.BG_COLOR,e.cnvsNext.style.width=e.NEXT_WIDTH+"px",e.cnvsNext.style.height=e.NEXT_HEIGHT+"px",e.cnvsNext.width=2*e.NEXT_WIDTH,e.cnvsNext.height=2*e.NEXT_HEIGHT,e.ctxNext.scale(2,2),e.ctxNext.strokeStyle=e.BG_COLOR,e.setBlurEvent(),e.setKeyEvent(),e.setTouchEvent(),e.renderId=setInterval(function(){n.render()},e.RENDER_INTERVAL),e}return s(t,e),a(t,[{key:"setBlurEvent",value:function(){var e=this;window.addEventListener("blur",function(){e.pauseGame()},!1),window.addEventListener("focus",function(){e.resumeGame()},!1)}},{key:"setKeyEvent",value:function(){var e=this;document.addEventListener("keydown",function(t){"undefined"!=typeof e.KEYS[t.keyCode]&&(t.preventDefault(),e.moveBlock(e.KEYS[t.keyCode]))},!1)}},{key:"setTouchEvent",value:function(){var e,t,n=this,r=new m.default({element:this.cnvs}),i=!1,o=!1;r.on("touchstart",function(n){e=n.touchStartX,t=n.touchStartY,i=!0,o=!1}),r.on("touchmove",function(r){var s=r.touchX-e,a=r.touchY-t,u=s/n.BLOCK_SIZE|0,c=a/n.BLOCK_SIZE|0;if(!o){for(;u;){var h=u/Math.abs(u);if(!n.valid(h,0))break;n.currentX+=h,u-=h,e=r.touchX}for(;c>0&&n.valid(0,1);)n.currentY++,c--,t=r.touchY;i=!1}}),r.on("touchend",function(e){i&&n.moveBlock("rotate")}),this.on("freeze",function(){o=!0})}},{key:"newGame",value:function(){this.initGame(),this.startGame()}},{key:"initGame",value:function(){clearTimeout(this.tickId),clearInterval(this.renderId),this.isPlayng=!1,this.lose=!1,this.tickInterval=this.DEFAULT_TICK_INTERVAL,this.sumOfClearLines=0,this.score=0,this.frameCount=0,this.initBoad(),this.initBlock(),this.createNextBlock(),this.render()}},{key:"startGame",value:function(){var e=this;this.isPlayng=!0,this.createNewBlock(),this.createNextBlock(),this.renderId=setInterval(function(){e.render()},this.RENDER_INTERVAL),this.emit("gamestart"),this.tick()}},{key:"initBoad",value:function(){this.board=[];for(var e=0;e<this.LOGICAL_ROWS;++e){this.board[e]=[];for(var t=0;t<this.COLS;++t)this.board[e][t]=0}}},{key:"initBlock",value:function(){this.currentBlock=[];for(var e=0;e<this.NUMBER_OF_BLOCK;++e){this.currentBlock[e]=[];for(var t=0;t<this.NUMBER_OF_BLOCK;++t)this.currentBlock[e][t]=0}this.currentBlockId=0,this.currentX=this.START_X,this.currentY=this.START_Y}},{key:"createNewBlock",value:function(){this.nextBlock[0]||this.createNextBlock(),this.currentBlock=this.nextBlock,this.currentBlockId=this.nextBlockId,this.currentX=this.START_X,this.currentY=this.START_Y,this.emit("newblockcreated")}},{key:"createNextBlock",value:function(){var e=Math.floor(Math.random()*_.default.length),t=_.default[e];this.nextBlockId=e,this.nextBlock=[];for(var n=0;n<this.NUMBER_OF_BLOCK;++n){this.nextBlock[n]=[];for(var r=0;r<this.NUMBER_OF_BLOCK;++r){var i=this.NUMBER_OF_BLOCK*n+r;this.nextBlock[n][r]=t[i]?e+1:0}}this.emit("nextblockcreated")}},{key:"tick",value:function(){var e=this;if(clearTimeout(this.tickId),!this.moveBlock("down")){if(this.freeze(),this.clearLines(),this.checkGameOver())return this.emit("gameover"),this.quitGame().then(function(){}),!1;this.frameCount++,this.createNewBlock(),this.createNextBlock()}this.tickId=setTimeout(function(){e.tick()},this.tickInterval),this.emit("tick")}},{key:"quitGame",value:function(){var e=this,t=c.default.Deferred();return this.gameOverEffect().then(function(){e.isPlayng=!1,e.emit("gamequit"),t.resolve()}),t.promise()}},{key:"pauseGame",value:function(){clearTimeout(this.tickId)}},{key:"resumeGame",value:function(){var e=this;this.isPlayng&&(this.tickId=setTimeout(function(){e.tick()},this.tickInterval))}},{key:"freeze",value:function(){for(var e=0;e<this.NUMBER_OF_BLOCK;++e)for(var t=0;t<this.NUMBER_OF_BLOCK;++t){var n=t+this.currentX,r=e+this.currentY;!this.currentBlock[e][t]||r<0||(this.board[r][n]=this.currentBlock[e][t])}this.emit("freeze")}},{key:"clearLines",value:function(){function e(e,t){return function(){var r=c.default.Deferred();return n.board[t][e]=n.CLEARLINE_BLOCK_INDEX,r.resolve(),r.promise()}}function t(e,t){return function(){var e=c.default.Deferred();if(i.length)return i.reverse().forEach(function(e){n.board.splice(e,1),n.board.unshift(o)}),e.resolve(),e.promise()}}var n=this,r=0,i=[],o=Array.apply(null,Array(this.COLS)).map(function(){return 0}),s=c.default.Deferred();s.resolve();for(var a=this.LOGICAL_ROWS-1;a>=0;--a){var u=this.board[a].every(function(e){return 0!==e});if(u){i.push(a),r++,this.sumOfClearLines++,this.tickInterval-=this.SPEEDUP_RATE;for(var h=0;h<this.COLS;++h)this.board[a][h]&&(s=s.then(e(h,a)).then(v.default.sleep(10)))}}s.then(t(h,a)),this.score+=r<=1?r:Math.pow(2,r),r>0&&this.emit("clearline",i)}},{key:"gameOverEffect",value:function(){function e(e,n){return function(){var r=c.default.Deferred();return t.board[n][e]=t.GAMEOVER_BLOCK_INDEX,t.emit("gameOverEffectTick"),r.resolve(),r.promise()}}var t=this,n=c.default.Deferred();n.resolve();for(var r=0;r<this.LOGICAL_ROWS;++r)for(var i=0;i<this.COLS;++i)this.board[r][i]&&(n=n.then(e(i,r)).then(v.default.sleep(10)));return this.emit("gameOverEffect"),n.then(v.default.sleep(500)).promise()}},{key:"moveBlock",value:function(e){switch(e){case"left":return!!this.valid(-1,0)&&(--this.currentX,!0);case"right":return!!this.valid(1,0)&&(++this.currentX,!0);case"down":return!!this.valid(0,1)&&(++this.currentY,!0);case"rotate":var t=this.rotate(this.currentBlock);return!!this.valid(0,0,t)&&(this.currentBlock=t,!0)}}},{key:"rotate",value:function(){for(var e=[],t=0;t<this.NUMBER_OF_BLOCK;++t){e[t]=[];for(var n=0;n<this.NUMBER_OF_BLOCK;++n)e[t][n]=this.currentBlock[this.NUMBER_OF_BLOCK-1-n][t]}return e}},{key:"valid",value:function(e,t,n){e=e||0,t=t||0;for(var r=this.currentX+e,i=this.currentY+t,o=n||this.currentBlock,s=0;s<this.NUMBER_OF_BLOCK;++s)for(var a=0;a<this.NUMBER_OF_BLOCK;++a){var u=a+r,c=s+i;if(o[s][a]&&("undefined"==typeof this.board[c]||"undefined"==typeof this.board[c][u]||this.board[c][u]||u<0||u>=this.COLS||c>=this.LOGICAL_ROWS))return!1}return!0}},{key:"checkGameOver",value:function(){for(var e=!0,t=0;t<this.NUMBER_OF_BLOCK;++t)for(var n=0;n<this.NUMBER_OF_BLOCK;++n){var r=(n+this.currentX,t+this.currentY);if(r>=this.HIDDEN_ROWS){e=!1;break}}return e}},{key:"render",value:function(){this.ctx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.ctx.fillStyle=this.BG_COLOR,this.ctx.fillRect(0,0,this.WIDTH,this.HEIGHT),this.renderBoard(),this.renderCurrentBlock(),this.renderNextBlock()}},{key:"renderBoard",value:function(){for(var e=0;e<this.COLS;++e)for(var t=0;t<this.ROWS;++t){var n=e,r=t+this.HIDDEN_ROWS,i=this.board[r][n]-1;!this.board[r][n]||i<0||this.drawBlock(e,t,i)}}},{key:"renderCurrentBlock",value:function(){for(var e=0;e<this.NUMBER_OF_BLOCK;++e)for(var t=0;t<this.NUMBER_OF_BLOCK;++t){var n=this.currentBlock[e][t]-1;if(this.currentBlock[e][t]&&!(n<0)){var r=t+this.currentX,i=e+this.currentY-this.HIDDEN_ROWS;this.drawBlock(r,i,n)}}}},{key:"renderNextBlock",value:function(){this.ctxNext.clearRect(0,0,this.NEXT_WIDTH,this.NEXT_HEIGHT);for(var e=0;e<this.NUMBER_OF_BLOCK;++e)for(var t=0;t<this.NUMBER_OF_BLOCK;++t){var n=this.nextBlock[e][t]-1;!this.nextBlock[e][t]||n<0||this.drawNextBlock(t,e,n)}}},{key:"drawBlock",value:function(e,t,n){var r=this.BLOCK_SIZE*e,i=this.BLOCK_SIZE*t,o=this.BLOCK_SIZE;this.ctx.fillStyle=this.COLOR_LIST[n],this.ctx.fillRect(r,i,o,o),this.ctx.strokeRect(r,i,o,o)}},{key:"drawNextBlock",value:function(e,t,n){var r=this.BLOCK_SIZE*e,i=this.BLOCK_SIZE*t,o=this.BLOCK_SIZE;this.ctxNext.fillStyle=this.COLOR_LIST[n],this.ctxNext.fillRect(r,i,o,o),this.ctxNext.strokeRect(r,i,o,o)}}]),t}(l.default);n.default=E},{"../constants/SHAPE_LIST":1,"./TouchController":4,"./Util":5,events:6,"jquery-deferred":7}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("events"),c=r(u),h=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.element=e.element||document,n.touchstartElement=e.touchstartElement||n.element,n.touchmoveElement=e.touchmoveElement||n.element,n.touchendElement=e.touchendElement||n.element,n.doubleTapDelay=e.doubleTapDelay||500,n.holdingDelay=e.holdingDelay||1e3,n.watchInterval=e.watchInterval||100,n.touchSupport="ontouchstart"in window,n.touchstart=n.touchSupport?"touchstart":"mousedown",n.touchmove=n.touchSupport?"touchmove":"mousemove",n.touchend=n.touchSupport?"touchend":"mouseup",n.deltaX=0,n.deltaY=0,n.moveX=0,n.moveY=0,n.defineEventListener(),n.setEvent(),n}return s(t,e),a(t,[{key:"setEvent",value:function(){this.touchstartElement.addEventListener(this.touchstart,this.onTouchStart,!1),this.touchmoveElement.addEventListener(this.touchmove,this.onTouchMove,!1),this.touchendElement.addEventListener(this.touchend,this.onTouchEnd,!1)}},{key:"dispose",value:function(){this.touchstartElement.removeEventListener(this.touchstart,this.onTouchStart,!1),this.touchmoveElement.removeEventListener(this.touchmove,this.onTouchMove,!1),this.touchendElement.removeEventListener(this.touchend,this.onTouchEnd,!1)}},{key:"defineEventListener",value:function(){var e=this,t=void 0,n=void 0,r=function(){clearInterval(t),clearTimeout(n)},i=function(){r(),n=setTimeout(function(){t=setInterval(function(){e.emit("touchholding",e)},e.watchInterval)},e.holdingDelay)};this.onTouchStart=function(t){t.preventDefault(),t.stopPropagation(),e.isDoubleTap=e.isTap,e.isDragging=!0,e.isTap=!0,e.touchStartTime=Date.now(),e.touchStartX=e.touchSupport?t.touches[0].pageX:t.pageX,e.touchStartY=e.touchSupport?t.touches[0].pageY:t.pageY,i(),e.emit("touchstart",{touchStartTime:e.touchStartTime,touchStartX:e.touchStartX,touchStartY:e.touchStartY})},this.onTouchMove=function(t){e.isDragging&&(r(),e.lasttouchX=e.touchX||e.touchStartX,e.lasttouchY=e.touchY||e.touchStartY,e.touchX=e.touchSupport?t.touches[0].pageX:t.pageX,e.touchY=e.touchSupport?t.touches[0].pageY:t.pageY,e.deltaX=e.touchX-e.lasttouchX,e.deltaY=e.touchY-e.lasttouchY,e.moveX=e.touchX-e.touchStartX,e.moveY=e.touchY-e.touchStartY,e.isTap=e.isDoubleTap=!1,i(),e.emit("touchmove",{lasttouchX:e.lasttouchX,lasttouchY:e.lasttouchY,touchX:e.touchX,touchY:e.touchY,deltaX:e.deltaX,deltaY:e.deltaY,moveX:e.moveX,moveY:e.moveY}))},this.onTouchEnd=function(t){e.isDragging=!1,r(),e.elapsedTime=Date.now()-e.touchStartTime,e.touchEndX=e.touchX,e.touchEndY=e.touchY,e.emit("touchend",{elapsedTime:e.elapsedTime,touchEndX:e.touchEndX,touchEndY:e.touchEndY,moveX:e.moveX,moveY:e.moveY,isTap:e.isTap,isDoubleTap:e.isDoubleTap}),e.touchX=e.touchY=null,e.moveX=e.moveY=0,setTimeout(function(){e.isTap=e.isDoubleTap=!1},e.doubleTapDelay)}}}]),t}(c.default);n.default=h},{events:6}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("jquery-deferred"),o=r(i);window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){var t=window.setTimeout(e,1e3/60);return t},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(e){window.clearTimeout(e)};var s={TRANSITIONEND:"transitionend webkitTransitionEnd mozTransitionEnd msTransitionEnd oTransitionEnd",ANIMATIONEND:"animationend webkitAnimationEnd mozAnimationEnd msAnimationEnd oAnimationEnd",getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},throttle:function(e,t){var n=!1,r=function(r){n||(n=!0,setTimeout(function(){n=!1,e(r)},t))};return r},debounce:function(e,t){var n,r=function(r){clearTimeout(n),n=setTimeout(function(){e(r)},t)};return r},async:function(e){!function t(n){e[n]&&e[n](function(){t(n+1)})}(0)},delay:function(e){return function(t){setTimeout(t,e)}},sleep:function(e){return function(){var t=o.default.Deferred();return setTimeout(function(){t.resolve()},e),t.promise()}},zeroPadding:function(e,t){return(new Array(t).join("0")+e).slice(-t)},getQueryString:function(){var e={},t=window.location.search;if(t.length>1)for(var n=t.substring(1),r=n.split("&"),i=0;i<r.length;i++){var o=r[i].split("="),s=decodeURIComponent(o[0]),a=decodeURIComponent(o[1]);e[s]=a}return e},getUserAgent:function(){return s.ua={},s.ua.name=window.navigator.userAgent.toLowerCase(),s.ua.isSP=/ipod|iphone|ipad|android/i.test(s.ua.name),s.ua.isPC=!s.ua.isSP,s.ua.isIOS=/ipod|iphone|ipad/i.test(s.ua.name),s.ua.isAndroid=/android/.test(s.ua.name),s.ua.isIE=/msie|trident/i.test(s.ua.name),s.ua.isIE8=/msie 8/.test(s.ua.name),s.ua.isIE9=/msie 9/.test(s.ua.name),s.ua.isIE10=/msie 10/.test(s.ua.name),s.ua.isMac=/macintosh/.test(s.ua.name),s.ua.isChrome=/chrome/.test(s.ua.name),s.ua.isFirefox=/firefox/.test(s.ua.name),s.ua.isSafari=/safari/.test(s.ua.name),s.ua.isMacSafari=s.ua.isSafari&&s.ua.isMac&&!s.ua.isChrome,s.ua.isSP&&(document.body.className+=" isSP"),s.ua.isPC&&(document.body.className+=" isPC"),s.ua}};t.exports=s},{"jquery-deferred":7}],6:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(s(n))for(o=Array.prototype.slice.call(arguments,1),c=n.slice(),r=c.length,u=0;u<r;u++)c[u].apply(this,o);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],7:[function(e,t,n){t.exports=e("./lib/jquery-deferred")},{"./lib/jquery-deferred":10}],8:[function(e,t,n){function r(e){var t=s[e]={};return i.each(e.split(o),function(e,n){t[n]=!0}),t}var i=t.exports=e("./jquery-core.js"),o=/\s+/,s={};i.Callbacks=function(e){e="string"==typeof e?s[e]||r(e):i.extend({},e);var t,n,o,a,u,c,h=[],l=!e.once&&[],f=function(r){for(t=e.memory&&r,n=!0,c=a||0,a=0,u=h.length,o=!0;h&&c<u;c++)if(h[c].apply(r[0],r[1])===!1&&e.stopOnFalse){t=!1;break}o=!1,h&&(l?l.length&&f(l.shift()):t?h=[]:v.disable())},v={add:function(){if(h){var n=h.length;!function t(n){i.each(n,function(n,r){var o=i.type(r);"function"===o?e.unique&&v.has(r)||h.push(r):r&&r.length&&"string"!==o&&t(r)})}(arguments),o?u=h.length:t&&(a=n,f(t))}return this},remove:function(){return h&&i.each(arguments,function(e,t){for(var n;(n=i.inArray(t,h,n))>-1;)h.splice(n,1),o&&(n<=u&&u--,n<=c&&c--)}),this},has:function(e){return i.inArray(e,h)>-1},empty:function(){return h=[],this},disable:function(){return h=l=t=void 0,this},disabled:function(){return!h},lock:function(){return l=void 0,t||v.disable(),this},locked:function(){return!l},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!h||n&&!l||(o?l.push(t):f(t)),this},fire:function(){return v.fireWith(this,arguments),this},fired:function(){return!!n}};return v}},{"./jquery-core.js":9}],9:[function(e,t,n){function r(e){return null==e?String(e):l[h.call(e)]||"object"}function i(e){return"function"===c.type(e)}function o(e){return"array"===c.type(e)}function s(e,t,n){var r,o=0,s=e.length,a=void 0===s||i(e);if(n)if(a){for(r in e)if(t.apply(e[r],n)===!1)break}else for(;o<s&&t.apply(e[o++],n)!==!1;);else if(a){for(r in e)if(t.call(e[r],r,e[r])===!1)break}else for(;o<s&&t.call(e[o],o,e[o++])!==!1;);return e}function a(e){return!(!e||"object"!==c.type(e))}function u(){var e,t,n,r,i,o,s=arguments[0]||{},a=1,u=arguments.length,h=!1;for("boolean"==typeof s&&(h=s,s=arguments[1]||{},a=2),"object"==typeof s||c.isFunction(s)||(s={}),u===a&&(s=this,--a);a<u;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],r=e[t],s!==r&&(h&&r&&(c.isPlainObject(r)||(i=c.isArray(r)))?(i?(i=!1,o=n&&c.isArray(n)?n:[]):o=n&&c.isPlainObject(n)?n:{},s[t]=c.extend(h,o,r)):void 0!==r&&(s[t]=r));return s}var c=t.exports={type:r,isArray:o,isFunction:i,isPlainObject:a,each:s,extend:u,noop:function(){}},h=Object.prototype.toString,l={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(e){l["[object "+e+"]"]=e.toLowerCase()})},{}],10:[function(e,t,n){/*!
* jquery-deferred
* Copyright(c) 2011 Hidden <zzdhidden@gmail.com>
* MIT Licensed
*/
var r=t.exports=e("./jquery-callbacks.js"),i=Array.prototype.slice;r.extend({Deferred:function(e){var t=[["resolve","done",r.Callbacks("once memory"),"resolved"],["reject","fail",r.Callbacks("once memory"),"rejected"],["notify","progress",r.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var e=arguments;return r.Deferred(function(n){r.each(t,function(t,i){var s=i[0],a=e[t];o[i[1]](r.isFunction(a)?function(){var e=a.apply(this,arguments);e&&r.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===o?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return null!=e?r.extend(e,i):i}},o={};return i.pipe=i.then,r.each(t,function(e,r){var s=r[2],a=r[3];i[r[1]]=s.add,a&&s.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),o[r[0]]=s.fire,o[r[0]+"With"]=s.fireWith}),i.promise(o),e&&e.call(o,o),o},when:function(e){var t,n,o,s=0,a=i.call(arguments),u=a.length,c=1!==u||e&&r.isFunction(e.promise)?u:0,h=1===c?e:r.Deferred(),l=function(e,n,r){return function(o){n[e]=this,r[e]=arguments.length>1?i.call(arguments):o,r===t?h.notifyWith(n,r):--c||h.resolveWith(n,r)}};if(u>1)for(t=new Array(u),n=new Array(u),o=new Array(u);s<u;s++)a[s]&&r.isFunction(a[s].promise)?a[s].promise().done(l(s,o,a)).fail(h.reject).progress(l(s,n,t)):--c;return c||h.resolveWith(o,a),h.promise()}})},{"./jquery-callbacks.js":8}]},{},[2]);